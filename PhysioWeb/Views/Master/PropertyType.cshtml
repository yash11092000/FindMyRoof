@model PhysioWeb.Models.PropertyTypeMaster
@{
	ViewBag.Title = "Property Type";
}
<style>
	/* ✅ Emerald Tabs */
	.emerald-tabs .nav-link {
		border-radius: 30px;
		padding: 8px 20px;
		background: #f9f9f9;
		color: #2ecc71;
		border: 1px solid #2ecc71;
		margin-right: 5px;
		transition: all 0.3s ease;
	}

		.emerald-tabs .nav-link.active {
			background: #2ecc71;
			color: #fff;
		}

		.emerald-tabs .nav-link:hover {
			background: #27ae60;
			color: #fff;
		}

	/* ✅ Emerald Card */
	.emerald-card {
		border-radius: 12px;
		border: none;
		background: #fff;
	}

	.emerald-header {
		background: #2ecc71;
		color: #fff;
		font-weight: 500;
	}

	/* ✅ Emerald Buttons */
	.emerald-btn {
		background: #2ecc71;
		border: none;
		color: #fff;
	}

		.emerald-btn:hover {
			background: #27ae60;
		}

	/* ✅ Table Icons */
	.emerald-icon {
		font-size: 20px;
		color: #2ecc71;
	}

		.emerald-icon:hover {
			color: #27ae60;
		}

	.emerald-icon-delete {
		font-size: 20px;
		color: #e74c3c;
	}

		.emerald-icon-delete:hover {
			color: #c0392b;
		}

</style>
<link rel="stylesheet" href="https://cdn.datatables.net/2.3.2/css/dataTables.dataTables.min.css" />
<div class="container mt-4">
	<div class="d-flex justify-content-between align-items-center mb-3">
		<h4 class="mb-0">Property Types</h4>
		<button class="btn emerald-btn" data-bs-toggle="modal" data-bs-target="#addPropertyModal">
			➕ Add Property Type
		</button>
	</div>

	<!-- ✅ Table -->
	<div class="card emerald-card shadow-sm">
		<div class="card-body">
			<div class="table-responsive">
				<table id="TableList" class="table table-hover align-middle">
					<thead class="table-light">
						<tr>
							<th>Property Type</th>
							<th>Description</th>
							<th>InActive</th>
							<th>Created By</th>
							<th><i class="bi bi-clock-history emerald-icon" title="History"></i></th>
							<th><i class="bi bi-pencil-square emerald-icon" title="Edit"></i></th>
							<th><i class="bi bi-trash emerald-icon-delete" title="Delete"></i></th>
						</tr>
					</thead>
					<tbody></tbody>
				</table>
			</div>
		</div>
	</div>
</div>

<!-- ✅ Modal -->
<div class="modal fade" id="addPropertyModal" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content emerald-card">
			<div class="modal-header emerald-header">
				<h5 class="modal-title">Add New Property Type</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<form id="propertyForm">
					<div class="mb-3">
						<label class="form-label">Property Type</label>
						<input type="text" class="form-control" id="PropertyType" name="PropertyType" placeholder="Enter property type" />
					</div>
					<div class="mb-3">
						<label class="form-label">Description</label>
						<textarea class="form-control" id="Description" name="Description" rows="3" placeholder="Enter description"></textarea>
					</div>
					<div class="form-check mb-3">
						<input class="form-check-input" type="checkbox" id="IsActive" name="IsActive" />
						<label class="form-check-label" for="isActive">Is Active</label>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
				<button type="button" class="btn emerald-btn" id="btnSave">💾 Save</button>
			</div>
		</div>
	</div>
</div>
@section Scripts {
	<script src="https://cdn.datatables.net/2.3.2/js/dataTables.min.js"></script>
	<script>

		   $(document).ready(function () {

				$('#TableList thead tr').clone(true).appendTo('#TableList thead');

				$('#TableList thead tr:eq(1) th').each(function (i) {
					if ($(this).find('i').length === 0) { // ✅ only add input if no icon
						var title = $('#TableList thead tr:eq(0) th').eq(i).text().trim();
						$(this).html('<input class="form-control form-control-sm" type="text" placeholder="' + title + '" />');
					} else {
						$(this).html('');
					}
				});
				var TableList = $("#TableList").DataTable({
				orderCellsTop: true,
				processing: true,
				serverSide: true,
				order: [[0, "asc"]],
				ajax: {
					url: '/Master/ListPropertyType',
					type: 'POST' , // or 'GET' depending on your controller setup
				},
				columns: [
					{ data: 'propertyType' },
					{ data: 'description' },
					{ data: 'inActiveText' },
					{ data: 'createdBy' },
								{
						data: null,
						render: function (data, type, full, meta) {
							var para = full.uniquId + ',' + '"Master"' + ',' + '"PropertyType"';
							return `<a href="javascript:void(0)" onclick="ViewHistory(${para})">
										<i class="bi bi-clock-history" title="History" style="font-size:24px;color:#2ecc71;"></i>
									</a>`;
						},
						orderable: false,
						searchable: false
					},
					{
						data: null,
						render: function (data, type, full, meta) {
							var para = full.uniquId + ',' + '"Master"' + ',' + '"EditPropertyType"';
							return `<a href="javascript:void(0)" onclick="EditData(${para})">
										<i class="bi bi-pencil-square" title="Edit" style="font-size:24px;color:#27ae60;"></i>
									</a>`;
						},
						orderable: false,
						searchable: false
					},
					{
						data: null,
						render: function (data, type, full, meta) {
							var para = full.uniquId + ',' + '"PropertyType"' + ',' + '"PropertyTypeID"';
							return `<a href="javascript:void(0)" onclick="delEntryCheck(${para})">
										<i class="bi bi-trash" title="Delete" style="font-size:24px;color:#e74c3c;"></i>
									</a>`;
						},
						orderable: false,
						searchable: false
					}

				],
				initComplete: function () {
						 var table = this.api();

		// ✅ Attach filter inputs to correct column index
		$('#TableList thead tr:eq(1) th').each(function (i) {
			$('input', this).on('keyup change', function () {
				if (table.column(i).search() !== this.value) {
					table
						.column(i)
						.search(this.value) // ✅ per-column search
						.draw();
				}
			});
		});
				}
			});

		});


			$("#btnSave").on("click", function () {

			let PropertyType = $("#PropertyType");

			if (PropertyType.val() == "") {
				notyf.error("Please enter Property Type");
				PropertyType.focus();
				return;
			}

			$.ajax({
				url: '/Master/SavePropertyType',
				method: 'POST',
				data: $("#propertyForm").serialize(),
				success: function (response) {
					if (response) {  // ✅ Expecting { success: true }
						notyf.success("Property Type added successfully");

						$("#addPropertyModal").modal('hide');


						$("#TableList").DataTable().ajax.reload(null, false);
					}
					else {
						notyf.error(response.message || "Failed to save.");
					}
				},
				error: function () {
					notyf.error("Some error occurred while saving");
				}
			});
		});

	</script>
}